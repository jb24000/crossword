<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🎮 NES Crossword 🎮</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
body {
  font-family: 'Press Start 2P', cursive;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  margin: 0;
  min-height: 100vh;
  transition: background 0.4s, color 0.4s;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 0;
}
.container {
  max-width: 480px;
  margin: 40px auto 0 auto;
  background: rgba(0,0,0,0.4);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  padding: 32px 18px 24px 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.title {
  font-size: 24px;
  color: #00ff88;
  margin-bottom: 10px;
  font-weight: bold;
  text-shadow: 2px 2px 0px #000;
  letter-spacing: 1px;
  text-align: center;
}
.toggles {
  display: flex;
  justify-content: center;
  gap: 24px;
  margin-bottom: 18px;
}
.switch { position:relative; display:inline-block; width:50px; height:24px; }
.switch input{display:none;}
.slider { position:absolute; top:0; left:0; right:0; bottom:0; background:#ccc; border-radius:34px; transition:.4s; }
.slider:before { content:""; position:absolute; width:18px; height:18px; left:3px; bottom:3px; background:white; border-radius:50%; transition:.4s; }
input:checked+.slider { background:#00ff88; }
input:checked+.slider:before { transform:translateX(26px); }
.settings-label {
  font-size: 14px;
  color: #FFD700;
  margin-bottom: 10px;
  font-weight: bold;
  letter-spacing: 1px;
  text-align: center;
}
.lobby-form {
  display: flex;
  flex-direction: column;
  gap: 14px;
  width: 100%;
  align-items: center;
}
.lobby-form input, .lobby-form select {
  font-size: 16px;
  padding: 7px;
  border-radius: 8px;
  border: none;
  background: #f8f9fa;
  color: #222;
  width: 80%;
  max-width: 260px;
  margin: 0 auto;
  box-sizing: border-box;
}
.lobby-form label {
  font-size: 13px;
  color: #fff;
  margin-bottom: 2px;
  text-align: left;
  width: 80%;
  max-width: 260px;
}
body.light-mode .lobby-form label {
  color: #222;
}
.mode-buttons {
  display: flex;
  gap: 16px;
  margin-top: 10px;
  justify-content: center;
}
.mode-button {
  font-size: 16px;
  padding: 12px 20px;
  border: none;
  border-radius: 8px;
  background: #00ff88;
  color: #333;
  font-weight: bold;
  cursor: pointer;
  margin: 0 4px;
  transition: background 0.2s;
}
.mode-button:hover { background: #00cc6a; }
.hidden { display: none !important; }
#player2-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
}
#player2-section label, #player2-section input {
  width: 80%;
  max-width: 260px;
}
#back-to-one {
  margin-top: 8px;
  background: #00ff88;
  color: #222;
  border: none;
  border-radius: 8px;
  padding: 8px 12px;
  cursor: pointer;
  font-weight: bold;
  font-size: 14px;
  width: 80%;
  max-width: 260px;
}
#back-to-one:hover {
  background: #00cc6a;
}

/* Music Controls */
.music-controls {
  display: flex;
  gap: 6px;
  margin-top: -6px;
  position: relative;
  left: 49%;
  transform: translateX(-40%);
}
.music-controls button {
  font-family: 'Press Start 2P', cursive;
  font-size: 11px;
  padding: 5px 8px;
  border: none;
  border-radius: 6px;
  background: #00ff88;
  color: #222;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.2s;
}
.music-controls button:hover {
  background: #00cc6a;
}

/* Game Area Styles */
#game-area {
  display: none;
  width: 100%;
  max-width: 600px;
  margin: 20px auto;
  padding: 20px;
  background: rgba(0,0,0,0.4);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.3);
  text-align: center;
}
#hud {
  margin: 10px;
  font-size: 12px;
  color: #FFD700;
  background: rgba(0,0,0,0.4);
  padding: 6px 12px;
  border-radius: 8px;
  border: 2px solid #FFD700;
  box-shadow: 2px 2px 0px #333;
  display: inline-block;
}
#crossword {
  display: grid;
  gap: 2px;
  background: #222;
  margin: 20px auto;
  padding: 10px;
  border: 4px solid #FFD700;
  border-radius: 12px;
  box-shadow: inset 4px 4px 0px #000, 4px 4px 0px #333;
  justify-content: center;
}
.cell {
  width: 30px; height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f8f9fa;
  color: #000;
  font-size: 14px;
  border: 1px solid #444;
  position: relative;
  cursor: pointer;
  font-weight: bold;
  box-shadow: inset -2px -2px 0px #bbb, inset 2px 2px 0px #fff;
}
.black {
  background: #111;
  border: 1px solid #000;
  box-shadow: inset -2px -2px 0px #000;
  cursor: default;
}
.clue-number {
  font-size: 8px;
  position: absolute;
  top: 1px;
  left: 2px;
  color: #444;
}
.highlight {
  background: #FFD700 !important;
  color: #222 !important;
}
.active {
  outline: 2px solid #00ff88;
}
.clues {
  display: grid;
  grid-template-columns: 1fr 1fr;
  width: 90%;
  max-width: 600px;
  margin: 20px auto;
  gap: 20px;
  font-size: 11px;
}
.clue-list {
  background: rgba(0,0,0,0.5);
  border: 2px solid #FFD700;
  border-radius: 10px;
  padding: 10px;
  box-shadow: 3px 3px 0px #000;
}
.clue-list h3 {
  margin-bottom: 8px;
  font-size: 13px;
  color: #FFD700;
  border-bottom: 1px solid #FFD700;
  padding-bottom: 4px;
  text-align: center;
}
.clue-list ul {
  padding: 0;
  margin: 0;
  list-style: none;
}
.clue-list li {
  margin-bottom: 8px;
  line-height: 1.4;
  cursor: pointer;
  transition: color 0.2s;
}
.clue-list li:hover {
  color: #00ff88;
}
.game-buttons {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 10px;
}
.game-buttons button {
  padding: 10px 15px;
  font-size: 14px;
  cursor: pointer;
  border-radius: 8px;
  border: none;
  background: #00ff88;
  color: #222;
  font-weight: bold;
  transition: background 0.2s;
}
.game-buttons button:hover {
  background: #00cc6a;
}
.fade-black {
  position: fixed;
  left: 0; top: 0; width: 100vw; height: 100vh;
  background: rgba(0,0,0,0.95);
  color: #FFD700;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.7s;
}
.fade-black.show {
  opacity: 1;
  pointer-events: all;
}
.player-turn-display {
  font-size: 18px;
  color: #00ff88;
  margin-bottom: 10px;
  font-weight: bold;
}
.high-score-display {
  font-size: 14px;
  color: #FFD700;
  margin-top: 5px;
}
.leaderboard {
  text-align: center;
  margin-top: 18px;
}
.leaderboard-title {
  font-size: 14px;
  font-weight: bold;
  margin-bottom: 10px;
  color: #FFD700;
  border-bottom: 2px solid #FFD700;
  display: inline-block;
  padding-bottom: 4px;
  letter-spacing: 1px;
  text-align: center;
}
.tabs {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-bottom: 10px;
  flex-wrap: nowrap;
}
.tab {
  padding: 6px 12px;
  cursor: pointer;
  border-bottom: 3px solid transparent;
  color: #000;
  font-weight: normal;
  border-radius: 4px 4px 0 0;
  background: none;
  transition: color 0.2s;
  font-size: 12px;
}
.tab.active {
  border-color: #FFD700;
  font-weight: bold;
  color: #FFD700;
  background: rgba(255,255,255,0.05);
}
.leaderboard ul { list-style: none; padding: 0; margin: 0; }
.leaderboard li {
  margin: 5px 0;
  font-size: 12px;
  color: #000;
  font-weight: normal;
}

/* Light mode */
body.light-mode {
  background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
  color: #222;
}
.container.light-mode, #game-area.light-mode {
  background: rgba(255,255,255,0.7);
  color: #222;
}
.settings-label.light-mode { color: #222; }
.title.light-mode { color: #00b36b; text-shadow: 2px 2px 0px #fff; }
.lobby-form input.light-mode, .lobby-form select.light-mode {
  background: #fff;
  color: #222;
  border: 1px solid #bbb;
}
.mode-button.light-mode { background: #00ff88; color: #222; }
.mode-button.light-mode:hover { background: #00cc6a; }
#hud.light-mode {
  color: #222;
  border-color: #222;
  background: rgba(0,0,0,0.1);
  box-shadow: 2px 2px 0px #bbb;
}
#crossword.light-mode {
  background: #eee;
  border-color: #222;
  box-shadow: inset 4px 4px 0px #bbb, 4px 4px 0px #aaa;
}
.cell.light-mode {
  background: #fff;
  color: #222;
  border-color: #bbb;
  box-shadow: inset -2px -2px 0px #ddd, inset 2px 2px 0px #eee;
}
.black.light-mode {
  background: #ccc;
  border-color: #aaa;
  box-shadow: inset -2px -2px 0px #aaa;
}
.clue-number.light-mode { color: #888; }
.highlight.light-mode {
  background: #FFD700 !important;
  color: #222 !important;
}
.active.light-mode {
  outline: 2px solid #00b36b;
}
.clue-list.light-mode {
  background: rgba(255,255,255,0.5);
  border-color: #222;
  box-shadow: 3px 3px 0px #bbb;
}
.clue-list h3.light-mode {
  color: #222;
  border-color: #222;
}
.clue-list li.light-mode { color: #222; }
.clue-list li.light-mode:hover { color: #00b36b; }
.player-turn-display.light-mode { color: #00b36b; }
.high-score-display.light-mode { color: #222; }
.leaderboard-title.light-mode {
  color: #222;
  border-color: #222;
}
.tab.light-mode { color: #222; }
.tab.active.light-mode {
  border-color: #FFD700;
  color: #FFD700;
  background: rgba(0,0,0,0.05);
}

/* --- Mobile Fixes --- */
@media (max-width: 600px) {
  html, body {
    height: 100vh !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden !important;
  }

  .toggles {
    justify-content: space-evenly;
    width: 100%;
    margin-bottom: 12px;
  }

  .music-controls {
    margin-top: -4px;
    left: 50%;
    transform: translateX(-35%);
    gap: 6px;
  }

  #game-area {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    max-width: 100vw !important;
    max-height: 100vh !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    box-sizing: border-box !important;
    padding-bottom: 70px;
  }

  #crossword {
    transform: scale(0.9);
    transform-origin: top center;
    margin-bottom: 10px;
  }

  .cell {
    width: 24px !important;
    height: 24px !important;
    font-size: 12px !important;
  }

  .clues {
    max-height: 35vh;
    overflow-y: auto;
  }

  .tabs {
    position: sticky;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    padding: 6px 0;
    z-index: 10;
  }
}

@media (max-width: 400px) {
  #crossword {
    transform: scale(0.8);
    transform-origin: top center;
  }

  .cell {
    width: 22px;
    height: 22px;
    font-size: 11px;
  }

  .clues {
    font-size: 10px;
    max-height: 30vh;
  }

  .tabs {
    font-size: 11px;
  }
}


  </style>
</head>
<body>
<div class="container" id="lobby">
  <div class="title" id="title">🎮 NES Crossword 🎮</div>
  
  <div class="toggles">
    <label>🌙 Dark
      <label class="switch">
        <input type="checkbox" id="darkToggle" checked>
        <span class="slider"></span>
      </label>
    </label>
    <label>🔊 Sound
      <label class="switch">
        <input type="checkbox" id="soundToggle">
        <span class="slider"></span>
      </label>
    </label>
  </div>

  <!-- 🎵 Music Controls placed BELOW Sound toggle -->
  <div class="music-controls">
    <button id="prev-track">⏮ Prev</button>
    <button id="next-track">Next ⏭</button>
  </div>

    <div class="settings-label" id="settings-label">SETTINGS</div>
    <form class="lobby-form" id="lobby-form" onsubmit="return false;">
      <label for="player1-name">Player 1 Name:</label>
      <input type="text" id="player1-name" placeholder="Player 1" required />
      <div id="player2-section" class="hidden">
        <label for="player2-name">Player 2 Name:</label>
        <input type="text" id="player2-name" placeholder="Player 2" />
        <button type="button" id="back-to-one">Back to Player 1</button>
      </div>
      <label for="difficulty">Difficulty:</label>
      <select id="difficulty">
        <option value="kids">Kids</option>
        <option value="easy">Easy</option>
        <option value="medium" selected>Medium</option>
        <option value="hard">Hard</option>
      </select>
      <div class="mode-buttons">
        <button class="mode-button" id="start-single">Start Game</button>
        <button class="mode-button" id="start-two">2-Player Mode</button>
      </div>
    </form>
    <!-- YouTube Music Embed (hidden by default) -->
   <div id="music-player" style="width:0;height:0;overflow:hidden;">
  <iframe
    id="yt-music"
    width="0"
    height="0"
    frameborder="0"
    allow="autoplay; encrypted-media"
    src="https://www.youtube.com/embed/BlBbwNgeOqQ?autoplay=1&loop=1&playlist=BlBbwNgeOqQ&controls=0&muted=1&enablejsapi=1"
  ></iframe>
   </div>
    <div class="leaderboard">
      <div class="leaderboard-title">Leaderboard</div>
      <div class="tabs">
        <div class="tab" onclick="switchTab('kids')">Kids</div>
        <div class="tab" onclick="switchTab('easy')">Easy</div>
        <div class="tab active" onclick="switchTab('medium')">Medium</div>
        <div class="tab" onclick="switchTab('hard')">Hard</div>
      </div>
      <ul id="leaderboard-list"></ul>
    </div>
  </div>

  <!-- Crossword Game Area -->
  <div id="game-area">
    <div class="player-turn-display" id="player-turn-display"></div>
    <div id="hud">Score: 0 | Time: 0 | Words: 0</div>
    <div class="high-score-display" id="high-score-display">High Score: 0</div>
    <div id="crossword"></div>
    <div class="clues">
      <div class="clue-list" id="across-clues">
        <h3>Across</h3>
        <ul></ul>
      </div>
      <div class="clue-list" id="down-clues">
        <h3>Down</h3>
        <ul></ul>
      </div>
    </div>
    <div class="game-buttons">
      <button onclick="useHint()">Get Hint</button>
      <button onclick="checkPuzzle()">Check Puzzle</button>
      <button onclick="revealPuzzle()">Reveal Puzzle</button>
      <button onclick="backToLobby()">🏠 Back to Lobby</button>
    </div>
  </div>

  <div class="fade-black" id="fade-black"></div>

  <!-- Win/Lose Sounds -->
  <audio id="win-sound" src="win.mp3" preload="auto"></audio>
  <audio id="lose-sound" src="lose.mp3" preload="auto"></audio>
  
  
 

  <script>
    // --- Word Banks (from your Hangman game) ---
    const wordBanks = {
      easy: [
        'animal',
        'basket',
        'button',
        'castle',
        'dinner',
        'eleven',
        'frozen',
        'garden',
        'happy',
        'island',
        'jacket',
        'kitchen',
        'ladder',
        'monkey',
        'number',
        'orange',
        'pencil',
        'rabbit',
        'school',
        'turtle',
        'uncle',
        'valley',
        'window',
        'yellow',
        'zebra',
        'answer',
        'branch',
        'cloudy',
        'donkey',
        'enough',
        'flower',
        'ground',
        'hungry',
        'inside',
        'jungle',
        'kitten',
        'letter',
        'middle',
        'nephew',
        'pickle',
        'ribbon',
        'simple',
        'things',
        'upward',
        'violet',
        'waffle',
        'yogurt',
        'zipper',
        'always',
        'banana',
        'candle',
        'doctor',
        'engine',
        'finger',
        'handle',
        'kindly',
        'listen',
        'market',
        'nature',
        'office',
        'person',
        'quarter',
        'reason',
        'summer',
        'turkey',
        'united',
        'violin',
        'winter',
        'yearly',
        'zombie',
        'apples',
        'bottle',
        'circle',
        'laptop',
        'mouse',
        'screen',
        'coffee',
        'remote',
        'charge',
        'energy',
        'family',
        'friend',
        'memory',
        'silver',
        'golden',
        'planet',
        'rocket',
        'travel',
        'teacher',
        'student',
        'library',
        'eraser',
        'marker',
        'supply',
        'lesson',
        'future',
        'dreams',
        'clouds',
        'light',
        'spring',
        'autumn',
        'forest',
        'desert',
        'river',
        'ocean',
        'giraffe',
        'panda',
        'whale',
        'sharks',
        'eagles',
        'wolves',
        'foxes',
        'puzzle',
        'chicken',
        'soccer',
        'pirate',
        'dragon',
        'wizard',
        'galaxy',
        'meteor',
        'comet',
        'corner',
        'falcon',
        'helmet',
        'insect',
        'jigsaw',
        'recipe',
        'spider',
        'vacuum',
        'walrus',
        'yonder',
        'baboon',
        'chisel',
        'dancer',
        'father',
        'gopher',
        'hammer',
        'infant',
        'jaguar',
        'lumber',
        'mother',
        'nugget',
        'onions',
        'sturdy',
        'toothy',
        'unique',
        'watery',
        'yawned',
        'zinger',
        'anchor',
        'bridge',
        'choppy',
        'dazzle',
        'geyser',
        'hobbit',
        'inform',
        'jackal',
        'kernel',
        'lizard',
        'magnet',
        'nodule',
        'parrot',
        'rescue',
        'sample',
        'thread',
        'uphill',
        'voyage',
        'wrench',
        'zapper',
        'bicycle',
        'example',
        'iceberg',
        'monster',
        'nothing',
        'outside',
        'pumpkin',
        'quietly',
        'somebody',
        'tomorrow',
        'birthday',
        'delivery',
        'friendly',
        'memories',
        'blankets',
        'creature',
        'dinosaur',
        'everyone',
        'festival',
        'magical',
        'sandwich',
        'together',
        'unicorns',
        'vacation',
        'fantasy',
        'heroic',
        'natural',
        'perfect',
        'quality',
        'shelter',
        'tonight',
        'whisper',
        'absorb',
        'attack',
        'beyond',
        'campus',
        'debate',
        'effect',
        'forget',
        'growth',
        'honest',
        'impact',
        'jumper',
        'mental',
        'notice',
        'obtain',
        'reform',
        'symbol',
        'throat',
        'volume',
        'wealth',
        'accept',
        'bigger',
        'copper',
        'deeply',
        'effort',
        'fought',
        'gather',
        'handle',
        'island',
        'jumble',
        'keeper',
        'liquid',
        'minute',
        'normal',
        'oppose',
        'public',
        'rotate',
        'supply',
        'threat',
        'uplift',
        'valley',
        'weight',
        'belief',
        'caught',
        'double',
        'forest',
        'golden',
        'height',
        'impose',
        'junior',
        'kicked',
        'landed',
        'method',
        'nearby',
        'origin',
        'plenty',
        'reward',
        'string',
        'tomato',
        'urgent',
        'vision',
        'wonder',
        'yonder'
      ],
      medium: [
        'queen',
        'october',
        'quiver',
        'iguana',
        'notebook',
        'printer',
        'holiday',
        'rainbow',
        'thunder',
        'mountain',
        'valleys',
        'dolphin',
        'rabbits',
        'baseball',
        'hockey',
        'volcano',
        'treasure',
        'spaceship',
        'science',
        'python',
        'variable',
        'function',
        'object',
        'array',
        'coding',
        'server',
        'internet',
        'network',
        'amazon',
        'google',
        'github',
        'docker',
        'oyster',
        'quartz',
        'earwig',
        'kneads',
        'quotas',
        'vulcan',
        'quiche',
        'football',
        'junkyard',
        'enormous',
        'graceful',
        'horrible',
        'jealousy',
        'kindness',
        'nonsense',
        'obtained',
        'pleasant',
        'quarters',
        'recently',
        'skeleton',
        'triangle',
        'universe',
        'villager',
        'yourself',
        'glorious',
        'haunting',
        'inventor',
        'jokester',
        'keyboard',
        'nautical',
        'observed',
        'princess',
        'quantity',
        'whistled',
        'yourself',
        'brilliant',
        'decision',
        'judgment',
        'research',
        'solution',
        'variety',
        'accepted',
        'graphics',
        'harmony',
        'machine',
        'remarks',
        'violent',
        'boundary',
        'document',
        'historic',
        'journal',
        'knuckle',
        'quilts',
        'xylose',
        'zipped',
        'approx',
        'xenial',
        'afraid',
        'before',
        'chance',
        'during',
        'gentle',
        'higher',
        'indeed',
        'locker',
        'modern',
        'native',
        'option',
        'profit',
        'quarry',
        'result',
        'stream',
        'tribal',
        'unfold',
        'victor',
        'xenons',
        'zephyr',
        'action',
        'choice',
        'defeat',
        'entire',
        'global',
        'hushed',
        'injury',
        'joyful',
        'lovely',
        'medium',
        'narrow',
        'openly',
        'pocket',
        'quotes',
        'return',
        'sundae',
        'thrust',
        'unlock',
        'absent',
        'bakery',
        'canyon',
        'deepen',
        'earthy',
        'fabric',
        'gravel',
        'humble',
        'insure',
        'keypad',
        'leader',
        'manage',
        'occupy',
        'packed',
        'quilty',
        'relate',
        'sector',
        'treaty',
        'unable',
        'vector',
        'warmth',
        'xylem',
        'yields',
        'accord',
        'depend',
        'extend',
        'firmly',
        'groups',
        'locked',
        'matrix',
        'revolve',
        'smooth',
        'trains',
        'avenue',
        'brunch',
        'chapel',
        'exceed',
        'hollow',
        'mobile',
        'opened',
        'ranger',
        'stripe',
        'towers',
        'upbeat',
        'asking',
        'border',
        'danger',
        'endless',
        'freeze',
        'goblin',
        'intact',
        'poetry',
        'secure',
        'triple',
        'wisdom',
        'zapped',
        'arctic',
        'bronze',
        'crisis',
        'employ',
        'hunger',
        'lights',
        'member',
        'turban',
        'abroad',
        'budget',
        'carbon',
        'define',
        'expert',
        'length',
        'opener',
        'sketch',
        'victim',
        'muscle',
        'deeper',
        'banner',
        'detail',
        'helper',
        'portal',
        'archer',
        'butter',
        'clover',
        'eleven',
        'hammer',
        'iguana',
        'ladder',
        'monkey',
        'orange',
        'pencil',
        'quiver',
        'school',
        'turtle',
        'uncle',
        'valley',
        'window',
        'yellow',
        'zebra',
        'answer',
        'branch',
        'cloudy',
        'donkey',
        'enough',
        'flower',
        'ground',
        'hungry',
        'inside',
        'jungle',
        'kitten',
        'letter',
        'middle',
        'nephew',
        'october',
        'pickle',
        'quiver',
        'ribbon',
        'simple',
        'things',
        'upward',
        'violet',
        'waffle',
        'yogurt',
        'zipper',
        'always',
        'banana',
        'candle',
        'doctor',
        'engine',
        'finger',
        'handle',
        'iguana',
        'kindly',
        'listen',
        'market',
        'nature',
        'office',
        'person',
        'quarter',
        'reason',
        'summer',
        'turkey',
        'united',
        'violin',
        'winter',
        'yearly',
        'zombie'
      ],
      hard: [
        'champion',
        'astronaut',
        'javascript',
        'terraform',
        'lambda',
        'elephant',
        'basketball',
        'spaceship',
        'brilliant',
        'decision',
        'research',
        'solution',
        'universe',
        'variety',
        'accepted',
        'graphics',
        'harmony',
        'machine',
        'natural',
        'perfect',
        'quality',
        'remarks',
        'shelter',
        'tonight',
        'violent',
        'whisper',
        'boundary',
        'document',
        'friendly',
        'historic',
        'journal',
        'machine',
        'natural',
        'perfect',
        'quality',
        'remarks',
        'shelter',
        'tonight',
        'violent',
        'whisper',
        'boundary',
        'xerces',
        'zoning',
        'quoted',
        'threat',
        'weight',
        'xylose',
        'zipped',
        'approx',
        'belief',
        'caught',
        'double',
        'effort',
        'forest',
        'golden',
        'height',
        'impose',
        'junior',
        'kicked',
        'landed',
        'method',
        'nearby',
        'origin',
        'plenty',
        'quoted',
        'reward',
        'string',
        'tomato',
        'urgent',
        'vision',
        'wonder',
        'xenial',
        'yonder',
        'zombie'
      ],
      kids: [
        'balloon',
        'puzzle',
        'rocket',
        'pirate',
        'castle',
        'jungle',
        'monster',
        'rainbow',
        'penguin',
        'blanket',
        'tractor',
        'diamond',
        'pumpkin',
        'treasure',
        'dolphin',
        'picture',
        'pancake',
        'popcorn',
        'unicorn',
        'scooter',
        'backpack',
        'crystal',
        'fortune',
        'journey',
        'lantern',
        'marbles',
        'octopus',
        'parasol',
        'peacock',
        'pretzel',
        'skating',
        'snowman',
        'tornado',
        'trouble',
        'whistle',
        'sandbox',
        'mailbox',
        'cabinet',
        'mailman',
        'acorn',
        'advent',
        'airship',
        'airport',
        'almond',
        'amazing',
        'amulet',
        'anchor',
        'animal',
        'antler',
        'apricot',
        'archery',
        'artist',
        'asteroid',
        'avalanche',
        'badger',
        'bagpipe',
        'balance',
        'bandage',
        'banquet',
        'barrel',
        'basket',
        'beacon',
        'beaver',
        'beetle',
        'believe',
        'bicycle',
        'blanket',
        'blossom',
        'blunder',
        'bobcat',
        'bonfire',
        'booklet',
        'boulder',
        'bravery',
        'breeze',
        'brother',
        'bubble',
        'builder',
        'butter',
        'cabbage',
        'cabinet',
        'cactus',
        'calmly',
        'camera',
        'canary',
        'candle',
        'caramel',
        'caravan',
        'carpet',
        'carving',
        'cascade',
        'castle',
        'caterer',
        'caveman',
        'celery',
        'centaur',
        'ceramic',
        'chamber',
        'charmer',
        'cheddar',
        'cheetah',
        'chimney',
        'chuckle',
        'circuit',
        'clarity',
        'climber',
        'cloaked',
        'clover',
        'clumsy',
        'cobweb',
        'compass',
        'coral',
        'cosmic',
        'costume',
        'cowbell',
        'cowgirl',
        'cracker',
        'crayon',
        'cricket',
        'crimson',
        'crumble',
        'crystal',
        'cupcake',
        'curious',
        'curtain',
        'cyclone',
        'dagger',
        'dazzle',
        'decade',
        'dewdrop',
        'diamond',
        'dolphin',
        'donut',
        'dragon',
        'drawer',
        'dreamer',
        'drizzle',
        'drummer',
        'duchess',
        'duffel',
        'dungeon',
        'eagerly',
        'earring',
        'echoes',
        'emerald',
        'enchant',
        'enigma',
        'enjoyed',
        'enough',
        'enrich',
        'escape',
        'excited',
        'explore',
        'eyebrow',
        'factory',
        'fairies',
        'fantasy',
        'faraway',
        'feather',
        'festival',
        'firefly',
        'fireman',
        'flannel',
        'flapper',
        'flicker',
        'flipper',
        'flourish',
        'flowers',
        'fortune',
        'foxhole',
        'fragile',
        'freckle',
        'freight',
        'frisbee',
        'frosted',
        'furnace',
        'gadget',
        'galaxy',
        'garland',
        'gazelle',
        'gemstone',
        'giraffe',
        'glacier',
        'glimmer',
        'glimpse',
        'goblet',
        'goggles',
        'goodbye',
        'gopher',
        'gown',
        'grace',
        'griddle',
        'griffin',
        'grizzly',
        'grouchy',
        'guitar',
        'gumball',
        'hammock',
        'hamster',
        'harvest',
        'hazel',
        'helmet',
        'hermit',
        'hickory',
        'highway',
        'horizon',
        'humming',
        'iceberg',
        'icicle',
        'imagine',
        'inspire',
        'island',
        'ivy',
        'jaguar',
        'jigsaw',
        'journey',
        'juggler',
        'jungle',
        'justice',
        'kangaro',
        'karate',
        'keeper',
        'kelp',
        'keyhole',
        'kingdom',
        'kitten',
        'knapsack',
        'knuckle',
        'ladder',
        'lantern',
        'laptop',
        'laundry',
        'lemon',
        'library',
        'lighten',
        'lizard',
        'lobster',
        'locket',
        'lollipop',
        'lumber',
        'magical',
        'magnet',
        'mailbox',
        'mailman',
        'marbles',
        'mariner',
        'marshes',
        'mascot',
        'meadow',
        'meander',
        'meerkat',
        'mermaid',
        'meteor',
        'midway',
        'mineral',
        'minnow',
        'miracle',
        'mission',
        'monster',
        'moonlit',
        'morning',
        'mosquito',
        'muffins',
        'murmur',
        'mystery',
        'napkin',
        'nectar',
        'nephew',
        'nestled',
        'nibbles',
        'nimble',
        'notable',
        'notepad',
        'novelty',
        'nugget',
        'oatmeal',
        'octopus',
        'odyssey',
        'officer',
        'onboard',
        'opaline',
        'orchard',
        'ostrich',
        'outback',
        'outdoor',
        'outpost',
        'overlap',
        'package',
        'pancake',
        'parasol',
        'parfait',
        'parrot',
        'patches',
        'peacock',
        'pebble',
        'pelican',
        'penguin',
        'pepperm',
        'petal',
        'phantom',
        'picnic',
        'picture',
        'pilgrim',
        'pirate',
        'pistach',
        'plaster',
        'playful',
        'plumber',
        'pockets',
        'popcorn',
        'postman',
        'pretzel',
        'prince',
        'prism',
        'pudding',
        'puffins',
        'pumpkin',
        'pursuit',
        'puzzle',
        'quilted',
        'quiver',
        'rabbit',
        'raccoon',
        'radical',
        'rainbow',
        'rambler',
        'ranger',
        'raspber',
        'reindeer',
        'rematch',
        'rescue',
        'riddles',
        'ringlet',
        'ripples',
        'robin',
        'rocket',
        'rooster',
        'rosebud',
        'rowboat',
        'ruffled',
        'saffron',
        'sailor',
        'salmon',
        'sandbox',
        'sapphire',
        'scarlet',
        'scenery',
        'scooter',
        'scuffle',
        'seagull',
        'seaside',
        'seasons',
        'seawall',
        'serpent',
        'shimmer',
        'shingle',
        'shuttle',
        'sidecar',
        'silence',
        'silvery',
        'skating',
        'skipper',
        'skyline',
        'slumber',
        'smuggle',
        'snicker',
        'snowman',
        'snuggle',
        'sorbet',
        'sparkle',
        'spindle',
        'spirit',
        'sprout',
        'squirrel',
        'starlet',
        'starlit',
        'sticker',
        'stirrup',
        'stumble',
        'subway',
        'sunbeam',
        'sunbird',
        'sunfish',
        'sunrise',
        'sunset',
        'surfing',
        'swallow',
        'swimmer',
        'tadpole',
        'tangled',
        'teacups',
        'teaspoon',
        'thimble',
        'thunder',
        'tickled',
        'tornado',
        'tractor',
        'treetop',
        'trouble',
        'truffle',
        'tulip',
        'tumbler',
        'turquoise',
        'twinkle',
        'umbrella',
        'unicorn',
        'uplands',
        'utensil',
        'vacancy',
        'valiant',
        'vanilla',
        'velvet',
        'venture',
        'village',
        'violet',
        'voyager',
        'waffles',
        'walnut',
        'warrior',
        'waspish',
        'weather',
        'whistle',
        'wildcat',
        'willows',
        'windmill',
        'wingman',
        'wishful',
        'wizard',
        'wombats',
        'wooden',
        'wrinkle',
        'yawning',
        'yodeler',
        'yonder',
        'zealous',
        'zippers',
        'zodiac',
        'zucchini'
      ]
    };

    // --- Game State Variables ---
    let player1Name = '';
    let player2Name = '';
    let currentDifficulty = 'medium';
    let isTwoPlayerMode = false;
    let currentPlayer = 1; // 1 or 2
    let player1Score = 0;
    let player2Score = 0;
    let currentPuzzleScore = 0; // Score for the current puzzle
    let currentPuzzleWordsCompleted = 0;
    let currentPuzzleTotalWords = 0;
    let timeLeft = 0;
    let timerInterval;
    let freeHintUsed = false;
    let gameOver = false;
    let currentHighScore = 0; // High score for the current difficulty

    // Leaderboard persistence
    let leaderboards = JSON.parse(localStorage.getItem('crosswordLeaderboards')) || { kids: [], easy: [], medium: [], hard: [] };
    ['kids', 'easy', 'medium', 'hard'].forEach(d => {
      if (!leaderboards[d]) leaderboards[d] = [];
    });
    let currentLeaderboardTab = 'medium';

    // --- UI Elements ---
    const lobbyDiv = document.getElementById('lobby');
    const gameAreaDiv = document.getElementById('game-area');
    const player1NameInput = document.getElementById('player1-name');
    const player2NameInput = document.getElementById('player2-name');
    const difficultySelect = document.getElementById('difficulty');
    const player2Section = document.getElementById('player2-section');
    const backToOneButton = document.getElementById('back-to-one');
    const hudDisplay = document.getElementById('hud');
    const highScoreDisplay = document.getElementById('high-score-display');
    const playerTurnDisplay = document.getElementById('player-turn-display');
    const darkToggle = document.getElementById('darkToggle');
    const soundToggle = document.getElementById('soundToggle');
    const ytMusicIframe = document.getElementById('yt-music');
    const winSound = document.getElementById('win-sound');
    const loseSound = document.getElementById('lose-sound');

    // --- Crossword Game Variables ---
    let gridSize, solutionGrid, playerGrid, words, wordsMap = [], clueCounter = 1;
    let activeWord = null, activeCellIndex = 0;

    // --- Theme and Sound Toggles ---
    if (!localStorage.getItem('theme')) localStorage.setItem('theme', 'dark');
    if (!localStorage.getItem('sound')) localStorage.setItem('sound', 'off');

    darkToggle.checked = localStorage.getItem('theme') === 'dark';
    soundToggle.checked = localStorage.getItem('sound') === 'on';
    setTheme(darkToggle.checked ? 'dark' : 'light');

    darkToggle.addEventListener('change', function () {
      setTheme(this.checked ? 'dark' : 'light');
      localStorage.setItem('theme', this.checked ? 'dark' : 'light');
    });

    function setTheme(mode) {
      document.body.classList.toggle('light-mode', mode === 'light');
      lobbyDiv.classList.toggle('light-mode', mode === 'light');
      gameAreaDiv.classList.toggle('light-mode', mode === 'light');
      document.getElementById('settings-label').classList.toggle('light-mode', mode === 'light');
      document.getElementById('title').classList.toggle('light-mode', mode === 'light');
      document.querySelectorAll('.lobby-form input, .lobby-form select').forEach(el => {
        el.classList.toggle('light-mode', mode === 'light');
      });
      document.querySelectorAll('.mode-button').forEach(el => {
        el.classList.toggle('light-mode', mode === 'light');
      });
      document.getElementById('hud').classList.toggle('light-mode', mode === 'light');
      document.getElementById('crossword').classList.toggle('light-mode', mode === 'light');
      document.querySelectorAll('.cell').forEach(el => el.classList.toggle('light-mode', mode === 'light'));
      document.querySelectorAll('.black').forEach(el => el.classList.toggle('light-mode', mode === 'light'));
      document.querySelectorAll('.clue-number').forEach(el => el.classList.toggle('light-mode', mode === 'light'));
      document.querySelectorAll('.clue-list').forEach(el => el.classList.toggle('light-mode', mode === 'light'));
      document.querySelectorAll('.clue-list h3').forEach(el => el.classList.toggle('light-mode', mode === 'light'));
      document.querySelectorAll('.clue-list li').forEach(el => el.classList.toggle('light-mode', mode === 'light'));
      playerTurnDisplay.classList.toggle('light-mode', mode === 'light');
      highScoreDisplay.classList.toggle('light-mode', mode === 'light');
      document.querySelector('.leaderboard-title').classList.toggle('light-mode', mode === 'light');
      document.querySelectorAll('.tab').forEach(el => el.classList.toggle('light-mode', mode === 'light'));
    }

    soundToggle.addEventListener('change', function () {
      localStorage.setItem('sound', this.checked ? 'on' : 'off');
      handleMusic(this.checked);
    });

 let musicStarted = false;

// 🎵 Playlist of YouTube video IDs
const playlist = [
  "fs0BCIUQ7Ws", // Track 1
  "VpqoE7ft284", // Track 2
  "TfEZaH_BBLY", // Track 3
  "V6SJzeegnck", // Track 4
  "pzkAKQJv19A", // Track 5
  "CIWo9e1Qzos", // Track 6
  "WvzVYC507gU", // Track 7
];
let currentTrackIndex = 0;

// Load and play a track
function loadTrack(index) {
  currentTrackIndex = (index + playlist.length) % playlist.length; // wrap around
  const videoId = playlist[currentTrackIndex];
  ytMusicIframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&loop=0&controls=0&muted=0&enablejsapi=1`;
  musicStarted = true;
}

// Handle Sound toggle 
function handleMusic(on) {
  if (on) {
    if (!musicStarted) {
      loadTrack(currentTrackIndex); // start first track
    } else {
      try {
        ytMusicIframe.contentWindow.postMessage(
          '{"event":"command","func":"playVideo","args":""}', '*'
        );
      } catch (e) {
        console.log('Music play failed:', e);
      }
    }
  } else {
    try {
      ytMusicIframe.contentWindow.postMessage(
        '{"event":"command","func":"pauseVideo","args":""}', '*'
      );
    } catch (e) {
      console.log('Music pause failed:', e);
    }
  }
}

// Manual Next / Prev buttons (respect sound toggle)
document.getElementById("next-track").addEventListener("click", () => {
  loadTrack(currentTrackIndex + 1, soundToggle.checked);
});
document.getElementById("prev-track").addEventListener("click", () => {
  loadTrack(currentTrackIndex - 1, soundToggle.checked);
});

// Auto-advance when track ends (respect sound toggle)
window.addEventListener("message", function (event) {
  if (event.data && typeof event.data === "string" && event.data.includes('"infoDelivery"')) {
    try {
      const data = JSON.parse(event.data);
      if (data.event === "infoDelivery" && data.info && data.info.playerState === 0) {
        // PlayerState === 0 => track ended
        loadTrack(currentTrackIndex + 1, soundToggle.checked);
      }
    } catch (e) {
      console.log("Player message parse error:", e);
    }
  }
});

// --- Sound Effects ---
function playWinSound() {
  if (soundToggle.checked) {
    winSound.currentTime = 0;
    winSound.play();
  }
}
function playLoseSound() {
  if (soundToggle.checked) {
    loseSound.currentTime = 0;
    loseSound.play();
  }
}

// Updated loadTrack to accept autoplay flag
function loadTrack(index, shouldPlay = true) {
  currentTrackIndex = (index + playlist.length) % playlist.length; // wrap around
  ytMusicIframe.src = `https://www.youtube.com/embed/${playlist[currentTrackIndex]}?autoplay=${shouldPlay ? 1 : 0}&loop=1&playlist=${playlist[currentTrackIndex]}&controls=0&muted=0&enablejsapi=1`;
  musicStarted = true;

  if (shouldPlay) {
    setTimeout(() => {
      try {
        ytMusicIframe.contentWindow.postMessage(
          '{"event":"command","func":"playVideo","args":""}', '*'
        );
      } catch (e) {
        console.log("Music auto-play failed:", e);
      }
    }, 1000);
  }
}


    // --- Lobby Mode Selection Logic ---
    document.getElementById('start-single').addEventListener('click', function () {
      isTwoPlayerMode = false;
      player2Section.classList.add('hidden');
      startGame();
    });

    document.getElementById('start-two').addEventListener('click', function () {
      isTwoPlayerMode = !isTwoPlayerMode;
      if (isTwoPlayerMode) {
        player2Section.classList.remove('hidden');
        this.textContent = 'Back to Player 1';
        player2NameInput.focus();
      } else {
        player2Section.classList.add('hidden');
        this.textContent = '2-Player Mode';
      }
    });

    backToOneButton.addEventListener('click', function () {
      isTwoPlayerMode = false;
      player2Section.classList.add('hidden');
      document.getElementById('start-two').textContent = '2-Player Mode';
    });

    // --- Leaderboard Functions ---
    function switchTab(tab) {
      currentLeaderboardTab = tab;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(t => {
        if (t.textContent.toLowerCase() === tab) {
          t.classList.add('active');
        }
      });
      renderLeaderboard();
    }

    function renderLeaderboard() {
      const list = document.getElementById('leaderboard-list');
      let arr = leaderboards[currentLeaderboardTab] || [];
      list.innerHTML = arr.length ? arr.slice(0, 5).map((e, i) => `<li>${i + 1}. ${e.name} — ${e.score}</li>`).join('') : '<li>No scores yet</li>';
    }

    function saveLeaderboard() {
      localStorage.setItem('crosswordLeaderboards', JSON.stringify(leaderboards));
    }

    function addScore(name, score, difficulty) {
      let arr = leaderboards[difficulty] || [];
      arr.push({ name, score });
      arr = arr.sort((a, b) => b.score - a.score).slice(0, 5);
      leaderboards[difficulty] = arr;
      saveLeaderboard();
      renderLeaderboard();
    }
    renderLeaderboard();

    // --- Game Flow & State Management ---
    function startGame() {
      player1Name = player1NameInput.value.trim() || "Player 1";
      player2Name = player2NameInput.value.trim() || "Player 2";
      currentDifficulty = difficultySelect.value;

      lobbyDiv.classList.add('hidden');
      gameAreaDiv.style.display = 'block';
      setTheme(darkToggle.checked ? 'dark' : 'light');

      if (isTwoPlayerMode) {
        currentPlayer = 1;
        player1Score = 0;
        player2Score = 0;
        startPlayerTurn();
      } else {
        currentPuzzleScore = 0;
        currentPuzzleWordsCompleted = 0;
        startNewPuzzle();
      }
    }

    function startPlayerTurn() {
      playerTurnDisplay.textContent = `${currentPlayer === 1 ? player1Name : player2Name}'s Turn`;
      currentPuzzleScore = 0;
      currentPuzzleWordsCompleted = 0;
      freeHintUsed = false;
      startNewPuzzle();
    }

    function startNewPuzzle() {
      gameOver = false;
      newCrossword(currentDifficulty);
      currentPuzzleTotalWords = wordsMap.length;
      currentPuzzleWordsCompleted = 0;
      timeLeft = currentPuzzleTotalWords * 30;
      updateHUD();
      startTimer();
    }

    function updateHUD() {
      currentHighScore = parseInt(localStorage.getItem('crosswordHighScore-' + currentDifficulty) || '0');
      highScoreDisplay.textContent = `High Score: ${currentHighScore}`;

      if (isTwoPlayerMode) {
        hudDisplay.textContent = `${player1Name}: ${player1Score} | ${player2Name}: ${player2Score} | Time: ${timeLeft}`;
      } else {
        hudDisplay.textContent = `Score: ${currentPuzzleScore} | Time: ${timeLeft} | Words: ${currentPuzzleWordsCompleted}/${currentPuzzleTotalWords}`;
      }
    }

    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        if (timeLeft > 0 && !gameOver) {
          timeLeft--;
          updateHUD();
        } else if (!gameOver) {
          clearInterval(timerInterval);
          gameOver = true;
          showFade(`⏰ Time's Up! Puzzle Failed!`);
          playLoseSound();
          setTimeout(() => {
            handlePuzzleEnd(false);
          }, 2000);
        }
      }, 1000);
    }

    function showFade(msg) {
      const fade = document.getElementById('fade-black');
      fade.innerHTML = msg;
      fade.classList.add('show');
      setTimeout(() => {
        fade.classList.remove('show');
      }, 1500);
    }

    function handlePuzzleEnd(completedSuccessfully) {
      clearInterval(timerInterval);
      gameOver = true;

      if (completedSuccessfully) {
        let timeBonus = timeLeft * 10;
        currentPuzzleScore += timeBonus;
        showFade(`🎉 Puzzle Complete! +${timeBonus} bonus!`);
        playWinSound();
      } else {
        showFade(`💀 Puzzle Failed!`);
        playLoseSound();
      }

      if (isTwoPlayerMode) {
        if (currentPlayer === 1) {
          player1Score += currentPuzzleScore;
        } else {
          player2Score += currentPuzzleScore;
        }
        setTimeout(() => {
          if (currentPlayer === 1) {
            currentPlayer = 2;
            startPlayerTurn();
          } else {
            let winnerText = player1Score > player2Score ? `${player1Name} Wins!` : player2Score > player1Score ? `${player2Name} Wins!` : "It's a Tie!";
            showFade(`Game Over! ${player1Name}: ${player1Score} | ${player2Name}: ${player2Score}<br>${winnerText}`);
            if (player1Score !== player2Score) playWinSound();
            setTimeout(() => backToLobby(), 3000);
          }
        }, 2000);
      } else {
        if (currentPuzzleScore > currentHighScore) {
          currentHighScore = currentPuzzleScore;
          localStorage.setItem('crosswordHighScore-' + currentDifficulty, currentHighScore);
        }
        addScore(player1Name, currentPuzzleScore, currentDifficulty);
        setTimeout(() => {
          if (completedSuccessfully) {
            currentPuzzleScore = 0;
            startNewPuzzle();
          } else {
            backToLobby();
          }
        }, 2000);
      }
    }

    function backToLobby() {
      clearInterval(timerInterval);
      lobbyDiv.classList.remove('hidden');
      gameAreaDiv.style.display = 'none';
      renderLeaderboard();
    }

    // --- Crossword Game Logic ---

    function settingsForDifficulty(diff) {
  switch (diff) {
    case "kids":
      return { min: 10, max: 15, size: 8 };
    case "easy":
      return { min: 15, max: 20, size: 10 };
    case "medium":
      return { min: 20, max: 30, size: 12 };
    case "hard":
      return { min: 30, max: 40, size: 15 };
    default:
      return { min: 20, max: 30, size: 12 };
  }
}

    function newCrossword(difficulty = "medium") {
  const { min, max, size } = settingsForDifficulty(difficulty);
  gridSize = size;
  solutionGrid = Array.from({ length: gridSize }, () => Array(gridSize).fill(""));
  playerGrid = Array.from({ length: gridSize }, () => Array(gridSize).fill(""));
  wordsMap = [];
  clueCounter = 1;

  let count = Math.floor(Math.random() * (max - min + 1)) + min;
  let shuffledWords = wordBanks[difficulty].sort(() => 0.5 - Math.random());
  let selectedWords = shuffledWords.slice(0, count);

  console.log('Difficulty:', difficulty, 'Word count:', count, 'Selected words:', selectedWords);

  // Place first word in center across
  if (selectedWords.length > 0) {
    placeWord(selectedWords[0], Math.floor(gridSize / 2), Math.floor((gridSize - selectedWords[0].length) / 2), "across");
  }

  // Try placing remaining words, retrying if placement fails
  for (let i = 1; i < selectedWords.length; i++) {
    let word = selectedWords[i];
    let placed = placeWordSmart(word);
    if (!placed) {
      // Try a few more times with different random order or positions if needed
      // For simplicity, just log failure here
      console.warn(`Could not place word: ${word}`);
    }
  }

  // Fill empty cells with "" (black cells)
  for (let r = 0; r < gridSize; r++) {
    for (let c = 0; c < gridSize; c++) {
      if (solutionGrid[r][c] === "") {
        solutionGrid[r][c] = "";
      }
    }
  }

  currentPuzzleTotalWords = wordsMap.length;
  currentPuzzleWordsCompleted = 0;
  updateHUD();

  renderGrid();
  renderClues();
}
    function placeWord(word, row, col, dir) {
      let isNewNumber = !wordsMap.some(w => w.row === row && w.col === col);
      let clueNumber = isNewNumber ? clueCounter++ :
        wordsMap.find(w => w.row === row && w.col === col).clueNumber;

      for (let i = 0; i < word.length; i++) {
        let r = row + (dir === "down" ? i : 0);
        let c = col + (dir === "across" ? i : 0);
        solutionGrid[r][c] = solutionGrid[r][c] || word[i];
      }
      wordsMap.push({ word, row, col, dir, clueNumber, solved: false });
    }

    function placeWordSmart(word) {
      for (let base of wordsMap) {
        for (let i = 0; i < base.word.length; i++) {
          let letter = base.word[i];
          for (let j = 0; j < word.length; j++) {
            if (word[j] === letter) {
              let dir = base.dir === "across" ? "down" : "across";
              let row = base.row + (base.dir === "down" ? i : 0) - (dir === "down" ? j : 0);
              let col = base.col + (base.dir === "across" ? i : 0) - (dir === "across" ? j : 0);
              if (canPlace(word, row, col, dir, j)) {
                placeWord(word, row, col, dir);
                return true;
              }
            }
          }
        }
      }
      return false;
    }

    function canPlace(word, row, col, dir, offset) {
      if (dir === "across") {
        if (col < 0 || col + word.length > gridSize || row < 0 || row >= gridSize) return false;
        if (col > 0 && solutionGrid[row][col - 1] !== "") return false;
        if (col + word.length < gridSize && solutionGrid[row][col + word.length] !== "") return false;
      } else {
        if (row < 0 || row + word.length > gridSize || col < 0 || col >= gridSize) return false;
        if (row > 0 && solutionGrid[row - 1][col] !== "") return false;
        if (row + word.length < gridSize && solutionGrid[row + word.length][col] !== "") return false;
      }
      for (let i = 0; i < word.length; i++) {
        let r = row + (dir === "down" ? i : 0);
        let c = col + (dir === "across" ? i : 0);
        if (r < 0 || c < 0 || r >= gridSize || c >= gridSize) return false;
        let existing = solutionGrid[r][c];
        if (existing !== "" && existing !== word[i]) return false;
        if (existing === "" && (
          (dir === "across" && ((solutionGrid[r - 1]?.[c] || "") !== "" || (solutionGrid[r + 1]?.[c] || "") !== "")) ||
          (dir === "down" && ((solutionGrid[r][c - 1] || "") !== "" || (solutionGrid[r][c + 1] || "") !== ""))
        )) return false;
      }
      return true;
    }

    function renderGrid() {
      const cw = document.getElementById("crossword");
      cw.innerHTML = "";
      cw.style.gridTemplateColumns = `repeat(${gridSize},30px)`;
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          let div = document.createElement("div");
          div.className = "cell";
          div.dataset.row = r;
          div.dataset.col = c;
          div.classList.toggle('light-mode', localStorage.getItem('theme') === 'light');

          if (solutionGrid[r][c] === "") {
            div.classList.add("black");
            div.classList.toggle('light-mode', localStorage.getItem('theme') === 'light');
          } else {
            let starter = wordsMap.find(w => w.row === r && w.col === c && w.clueNumber);
            if (starter) {
              let num = document.createElement("div");
              num.className = "clue-number";
              num.textContent = starter.clueNumber;
              num.classList.toggle('light-mode', localStorage.getItem('theme') === 'light');
              div.appendChild(num);
            }
            if (playerGrid[r][c] !== "") {
              div.textContent = playerGrid[r][c].toUpperCase();
            }
            div.onclick = () => selectWord(wordsMap.find(w =>
              r >= w.row && c >= w.col &&
              (w.dir === "across" ? r === w.row && c < w.col + w.word.length : c === w.col && r < w.row + w.word.length)
            ));
          }
          cw.appendChild(div);
        }
      }
    }

    async function getClue(word) {
      try {
        let res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
        let data = await res.json();
        let def = data[0]?.meanings?.[0]?.definitions?.[0]?.definition;
        if (def) return def;
      } catch (e) { }
      return `${word.length}-letter word starting with ${word[0].toUpperCase()}`;
    }

    function renderClues() {
      const across = document.querySelector("#across-clues ul");
      const down = document.querySelector("#down-clues ul");
      across.innerHTML = "";
      down.innerHTML = "";
      hudDisplay.textContent = "Fetching clues...";

      Promise.all(wordsMap.map(w => getClue(w.word).then(clue => ({ ...w, clue }))))
        .then(results => {
          results.forEach(w => {
            let li = document.createElement("li");
            li.innerHTML = `${w.clueNumber}. ${w.clue}`;
            li.onclick = () => selectWord(w);
            li.classList.toggle('light-mode', localStorage.getItem('theme') === 'light');
            if (w.dir === "across") across.appendChild(li);
            else down.appendChild(li);
          });
          updateHUD();
        });
    }

    function selectWord(word) {
      if (!word) return;
      activeWord = word;
      activeCellIndex = word.word.split('').findIndex((ch, i) => {
        let r = word.row + (word.dir === "down" ? i : 0);
        let c = word.col + (word.dir === "across" ? i : 0);
        return playerGrid[r][c] === "";
      });
      if (activeCellIndex === -1) activeCellIndex = 0;

      document.querySelectorAll(".cell").forEach(c => c.classList.remove("highlight", "active"));
      for (let i = 0; i < word.word.length; i++) {
        let r = word.row + (word.dir === "down" ? i : 0);
        let c = word.col + (word.dir === "across" ? i : 0);
        let cell = document.querySelector(`.cell[data-row='${r}'][data-col='${c}']`);
        if (cell) cell.classList.add("highlight");
      }
      focusCell();
    }

    function focusCell() {
      if (!activeWord) return;
      let r = activeWord.row + (activeWord.dir === "down" ? activeCellIndex : 0);
      let c = activeWord.col + (activeWord.dir === "across" ? activeCellIndex : 0);
      document.querySelectorAll(".cell").forEach(c => c.classList.remove("active"));
      let cell = document.querySelector(`.cell[data-row='${r}'][data-col='${c}']`);
      if (cell) cell.classList.add("active");
    }

    document.addEventListener("keydown", e => {
      if (!activeWord || gameOver) return;
      if (e.key.match(/^[a-zA-Z]$/)) {
        let r = activeWord.row + (activeWord.dir === "down" ? activeCellIndex : 0);
        let c = activeWord.col + (activeWord.dir === "across" ? activeCellIndex : 0);
        playerGrid[r][c] = e.key.toLowerCase();
        renderGrid();
        checkWordCompletion(activeWord);
        if (activeCellIndex < activeWord.word.length - 1) {
          activeCellIndex++;
          focusCell();
        } else {
          let nextWordIndex = wordsMap.findIndex(w => !w.solved);
          if (nextWordIndex !== -1) {
            selectWord(wordsMap[nextWordIndex]);
          } else {
            checkPuzzle();
          }
        }
      } else if (e.key === "Backspace") {
        let r = activeWord.row + (activeWord.dir === "down" ? activeCellIndex : 0);
        let c = activeWord.col + (activeWord.dir === "across" ? activeCellIndex : 0);
        if (playerGrid[r][c] === "" && activeCellIndex > 0) {
          activeCellIndex--;
          r = activeWord.row + (activeWord.dir === "down" ? activeCellIndex : 0);
          c = activeWord.col + (activeWord.dir === "across" ? activeCellIndex : 0);
        }
        playerGrid[r][c] = "";
        renderGrid();
        focusCell();
      } else if (["ArrowRight", "ArrowLeft", "ArrowUp", "ArrowDown"].includes(e.key)) {
        e.preventDefault();
        let newR = activeWord.row + (activeWord.dir === "down" ? activeCellIndex : 0);
        let newC = activeWord.col + (activeWord.dir === "across" ? activeCellIndex : 0);

        if (e.key === "ArrowRight") newC++;
        else if (e.key === "ArrowLeft") newC--;
        else if (e.key === "ArrowUp") newR--;
        else if (e.key === "ArrowDown") newR++;

        let newActiveWord = wordsMap.find(w =>
          newR >= w.row && newC >= w.col &&
          (w.dir === "across" ? newR === w.row && newC < w.col + w.word.length : newC === w.col && newR < w.row + w.word.length)
        );

        if (newActiveWord) {
          selectWord(newActiveWord);
          activeCellIndex = newActiveWord.word.split('').findIndex((char, i) => {
            let r = newActiveWord.row + (newActiveWord.dir === "down" ? i : 0);
            let c = newActiveWord.col + (newActiveWord.dir === "across" ? i : 0);
            return r === newR && c === newC;
          });
          focusCell();
        }
      }
    });

    function checkWordCompletion(wordObj) {
      let currentWordAttempt = '';
      for (let i = 0; i < wordObj.word.length; i++) {
        let r = wordObj.row + (wordObj.dir === "down" ? i : 0);
        let c = wordObj.col + (wordObj.dir === "across" ? i : 0);
        currentWordAttempt += playerGrid[r][c] || '';
      }

      if (currentWordAttempt.toLowerCase() === wordObj.word.toLowerCase() && !wordObj.solved) {
        wordObj.solved = true;
        currentPuzzleWordsCompleted++;
        currentPuzzleScore += 10;
        updateHUD();
        showFade(`Word "${wordObj.word.toUpperCase()}" Solved!`);
        if (wordsMap.every(w => w.solved)) {
          handlePuzzleEnd(true);
        }
      }
    }

    function checkPuzzle() {
      let allCorrect = true;
      for (const wordObj of wordsMap) {
        let currentWordAttempt = '';
        for (let i = 0; i < wordObj.word.length; i++) {
          let r = wordObj.row + (wordObj.dir === "down" ? i : 0);
          let c = wordObj.col + (wordObj.dir === "across" ? i : 0);
          currentWordAttempt += playerGrid[r][c] || '';
        }
        if (currentWordAttempt.toLowerCase() !== wordObj.word.toLowerCase()) {
          allCorrect = false;
          break;
        }
      }

      if (allCorrect) {
        handlePuzzleEnd(true);
      } else {
        showFade("Some words are incorrect. Keep trying!");
      }
    }

    function revealPuzzle() {
      if (gameOver) return;
      clearInterval(timerInterval);
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          if (solutionGrid[r][c] !== "") {
            playerGrid[r][c] = solutionGrid[r][c];
          }
        }
      }
      renderGrid();
      showFade("Puzzle Revealed!");
      setTimeout(() => {
        handlePuzzleEnd(false);
      }, 2000);
    }

    function useHint() {
      if (gameOver) return;
      let unsolvedWords = wordsMap.filter(w => !w.solved);
      if (unsolvedWords.length === 0) {
        showFade("All words are already solved!");
        return;
      }

      let wordToHint = unsolvedWords[Math.floor(Math.random() * unsolvedWords.length)];

      let hiddenLettersInWord = [];
      for (let i = 0; i < wordToHint.word.length; i++) {
        let r = wordToHint.row + (wordToHint.dir === "down" ? i : 0);
        let c = wordToHint.col + (wordToHint.dir === "across" ? i : 0);
        if (playerGrid[r][c] === "" || playerGrid[r][c].toLowerCase() !== wordToHint.word[i].toLowerCase()) {
          hiddenLettersInWord.push({ r, c, letter: wordToHint.word[i] });
        }
      }

      if (hiddenLettersInWord.length === 0) {
        wordToHint.solved = true;
        currentPuzzleWordsCompleted++;
        currentPuzzleScore += 10;
        updateHUD();
        useHint();
        return;
      }

      let hintCell = hiddenLettersInWord[Math.floor(Math.random() * hiddenLettersInWord.length)];
      playerGrid[hintCell.r][hintCell.c] = hintCell.letter;
      renderGrid();
      selectWord(wordToHint);

      let penalty = 0;
      if (!freeHintUsed) {
        freeHintUsed = true;
        showFade(`🆓 Free hint! "${hintCell.letter.toUpperCase()}" revealed in "${wordToHint.word.toUpperCase()}"`);
      } else {
        if (currentDifficulty === 'kids') penalty = 3;
        else if (currentDifficulty === 'easy') penalty = 5;
        else if (currentDifficulty === 'medium') penalty = 7;
        else penalty = 15;

        currentPuzzleScore -= penalty;
        if (currentPuzzleScore < 0) currentPuzzleScore = 0;
        updateHUD();
        showFade(`⚠️ Hint used! -${penalty} points. "${hintCell.letter.toUpperCase()}" revealed in "${wordToHint.word.toUpperCase()}"`);
      }
      checkWordCompletion(wordToHint);
    }

    // Initial setup
    document.addEventListener('DOMContentLoaded', () => {
      renderLeaderboard();
      setTheme(localStorage.getItem('theme') === 'dark' ? 'dark' : 'light');
    });
	
	// Track the last clicked crossword cell
let lastClickedCell = null;

// Capture clicks on crossword cells
document.addEventListener("click", function(event) {
  if (event.target.classList.contains("cell") && !event.target.classList.contains("black")) {
    lastClickedCell = event.target;
  }
});

// Listen for Backspace/Delete to clear the letter
document.addEventListener("keydown", function(event) {
  if (lastClickedCell && (event.key === "Backspace" || event.key === "Delete")) {
    event.preventDefault();
    lastClickedCell.textContent = ""; // remove the letter
  }
});
	
  </script>
</body>

</html>
